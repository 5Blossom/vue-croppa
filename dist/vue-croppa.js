!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Croppa=i()}(this,function(){"use strict";var t={getPointerCoords:function(t,i){var a=i.canvas,e=i.quality,n=a.getBoundingClientRect(),h=t.touches?t.touches[0].clientX:t.clientX,s=t.touches?t.touches[0].clientY:t.clientY;return{x:(h-n.left)*e,y:(s-n.top)*e}}},i={render:function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{class:"croppa-container "+(t.img?"croppa--has-target":"")},[a("input",{ref:"fileInput",attrs:{type:"file",accept:"image/*",hidden:""},on:{change:t.handleInputChange}}),a("canvas",{ref:"canvas",on:{click:t.selectFile,touchstart:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerStart(i)},mousedown:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerStart(i)},pointerstart:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerStart(i)},touchend:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerEnd(i)},touchcancel:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerEnd(i)},mouseup:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerEnd(i)},pointerend:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerEnd(i)},pointercancel:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerEnd(i)},touchmove:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerMove(i)},mousemove:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerMove(i)},pointermove:function(i){i.stopPropagation(),i.preventDefault(),t.handlePointerMove(i)},DOMMouseScroll:function(i){i.stopPropagation(),i.preventDefault(),t.handleWheel(i)},mousewheel:function(i){i.stopPropagation(),i.preventDefault(),t.handleWheel(i)}}}),t.showRemoveButton&&t.img?a("svg",{staticClass:"icon icon-remove",style:"top: -"+t.height/40+"px; right: -"+t.width/40+"px",attrs:{t:"1497460039530",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1074","xmlns:xlink":"http://www.w3.org/1999/xlink",width:t.width/10,height:t.width/10},on:{click:t.unset}},[a("path",{attrs:{d:"M511.921231 0C229.179077 0 0 229.257846 0 512 0 794.702769 229.179077 1024 511.921231 1024 794.781538 1024 1024 794.702769 1024 512 1024 229.257846 794.781538 0 511.921231 0ZM732.041846 650.633846 650.515692 732.081231C650.515692 732.081231 521.491692 593.683692 511.881846 593.683692 502.429538 593.683692 373.366154 732.081231 373.366154 732.081231L291.761231 650.633846C291.761231 650.633846 430.316308 523.500308 430.316308 512.196923 430.316308 500.696615 291.761231 373.523692 291.761231 373.523692L373.366154 291.918769C373.366154 291.918769 503.453538 430.395077 511.881846 430.395077 520.349538 430.395077 650.515692 291.918769 650.515692 291.918769L732.041846 373.523692C732.041846 373.523692 593.447385 502.547692 593.447385 512.196923 593.447385 521.412923 732.041846 650.633846 732.041846 650.633846Z","p-id":"1075",fill:"red"}})]):t._e()])},staticRenderFns:[],model:{prop:"value",event:"change"},props:{value:Object,width:Number,height:Number,placeholder:String,placeholderColor:String,placeholderFontSize:Number,canvasColor:String,quality:{default:2,type:Number},zoomSpeed:{default:3,type:Number,validator:function(t){return t>0}},reverseZoomingGesture:Boolean,preventWhiteSpace:Boolean,showRemoveButton:Boolean},data:function(){return{instance:null,canvas:null,ctx:null,img:null,dragging:!1,lastMovingCoord:null,imgData:{},dataUrl:""}},computed:{canvasWidth:function(){return this.width*this.quality},canvasHeight:function(){return this.height*this.quality}},mounted:function(){this.init()},watch:{value:function(t){this.instance=t},canvasWidth:"init",canvasHeight:"init",canvasColor:"init",placeholder:"init",placeholderColor:"init",placeholderFontSize:"init",preventWhiteSpace:"imgContentInit"},methods:{init:function(){var t=this;this.canvas=this.$refs.canvas,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvas.style.backgroundColor="default"==this.canvasColor?"#e6e6e6":this.canvasColor||"#e6e6e6",this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.ctx=this.canvas.getContext("2d"),this.unset(),this.$emit("change",{getCanvas:function(){return t.canvas},getContext:function(){return t.ctx},getImage:function(){return t.img},getImageData:function(){return t.imgData},reset:this.unset,selectFile:this.selectFile,generateDataUrl:this.generateDataUrl})},unset:function(){var t=this.ctx;t.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.textBaseline="middle",t.textAlign="center";var i=this.canvasWidth/1.5/this.placeholder.length,a=0==this.placeholderFontSize?i:this.placeholderFontSize||i;t.font=a+"px sans-serif",t.fillStyle="default"==this.placeholderColor?"#606060":this.placeholderColor||"#606060",t.fillText(this.placeholder,this.canvasWidth/2,this.canvasHeight/2),this.img=null,this.$refs.fileInput.value="",this.imgData={}},selectFile:function(){this.img||this.$refs.fileInput.click()},handleInputChange:function(){var t=this,i=this.$refs.fileInput;if(i.files.length){var a=i.files[0],e=new FileReader;e.onload=function(i){var a=i.target.result,e=new Image;e.src=a,e.onload=function(){t.img=e,t.imgContentInit()}},e.readAsDataURL(a)}},imgContentInit:function(){this.imgData.startX=0,this.imgData.startY=0;var t=this.img.naturalWidth,i=this.img.naturalHeight;if(i/t<this.canvasHeight/this.canvasWidth){var a=i/this.canvasHeight;this.imgData.width=t/a,this.imgData.startX=-(this.imgData.width-this.canvasWidth)/2,this.imgData.height=this.canvasHeight}else{var e=t/this.canvasWidth;this.imgData.height=i/e,this.imgData.startY=-(this.imgData.height-this.canvasHeight)/2,this.imgData.width=this.canvasWidth}this.draw()},handlePointerStart:function(t){if(!(t.which&&t.which>1)&&(this.dragging=!0,document)){var i=["mouseup","touchend","touchcancel","pointerend","pointercancel"],a=!0,e=!1,n=void 0;try{for(var h,s=i[Symbol.iterator]();!(a=(h=s.next()).done);a=!0){var o=h.value;document.addEventListener(o,this.handlePointerEnd)}}catch(t){e=!0,n=t}finally{try{!a&&s.return&&s.return()}finally{if(e)throw n}}}},handlePointerEnd:function(t){this.dragging=!1,this.lastMovingCoord=null},handlePointerMove:function(i){if(this.dragging){var a=t.getPointerCoords(i,this);this.lastMovingCoord&&this.move({x:a.x-this.lastMovingCoord.x,y:a.y-this.lastMovingCoord.y}),this.lastMovingCoord=a}},handleWheel:function(i){var a=t.getPointerCoords(i,this);i.wheelDelta<0||i.detail<0?this.zoom(this.reverseZoomingGesture,a):(i.wheelDelta>0||i.detail>0)&&this.zoom(!this.reverseZoomingGesture,a)},move:function(t){t&&(this.imgData.startX+=t.x,this.imgData.startY+=t.y,this.preventWhiteSpace&&this.preventMovingToWhiteSpace(),this.draw())},preventMovingToWhiteSpace:function(){this.imgData.startX>0&&(this.imgData.startX=0),this.imgData.startY>0&&(this.imgData.startY=0),this.canvasWidth-this.imgData.startX>this.imgData.width&&(this.imgData.startX=-(this.imgData.width-this.canvasWidth)),this.canvasHeight-this.imgData.startY>this.imgData.height&&(this.imgData.startY=-(this.imgData.height-this.canvasHeight))},zoom:function(t,i){var a=this.canvasWidth/1e5*this.zoomSpeed,e=1;t?e=1+a:this.imgData.width>20&&(e=1-a),this.imgData.width=this.imgData.width*e,this.imgData.height=this.imgData.height*e;var n=(e-1)*(i.x-this.imgData.startX),h=(e-1)*(i.y-this.imgData.startY);if(this.imgData.startX=this.imgData.startX-n,this.imgData.startY=this.imgData.startY-h,this.preventWhiteSpace){if(this.imgData.width<this.canvasWidth){var s=this.canvasWidth/this.imgData.width;this.imgData.width=this.canvasWidth,this.imgData.height=this.imgData.height*s}if(this.imgData.height<this.canvasHeight){var o=this.canvasHeight/this.imgData.height;this.imgData.height=this.canvasHeight,this.imgData.width=this.imgData.width*o}this.preventMovingToWhiteSpace()}this.draw()},draw:function(){var t=this.ctx;if(this.img){var i=this.imgData,a=i.startX,e=i.startY,n=i.width,h=i.height;t.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.drawImage(this.img,a,e,n,h)}},generateDataUrl:function(){return this.img?this.canvas.toDataURL():""}}};return{install:function(t,a){t.component("croppa",i)}}});
