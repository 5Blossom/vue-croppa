{"version":3,"file":"vue-croppa.js","sources":["../../src/util.js","../../node_modules/lodash/isObject.js","../../node_modules/lodash/_freeGlobal.js","../../node_modules/lodash/_root.js","../../node_modules/lodash/_objectToString.js","../../node_modules/lodash/isObjectLike.js","../../src/cropper.vue","../../src/main.js"],"sourcesContent":["export default {\r\n  getPointerCoords(evt, cropperVM) {\r\n    let { canvas, quality } = cropperVM\r\n    let rect = canvas.getBoundingClientRect()\r\n    let clientX = evt.touches ? evt.touches[0].clientX : evt.clientX\r\n    let clientY = evt.touches ? evt.touches[0].clientY : evt.clientY\r\n    return {\r\n      x: (clientX - rect.left) * quality,\r\n      y: (clientY - rect.top) * quality\r\n    }\r\n  }\r\n}","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","<template>\r\n  <div :class=\"`croppa-container ${hasTarget ? 'croppa--has-target' : ''}`\">\r\n    <input type=\"file\"\r\n           accept=\"image/*\"\r\n           ref=\"fileInput\"\r\n           hidden\r\n           @change=\"handleInputChange\" />\r\n    <canvas :width=\"canvasWidth\"\r\n            :height=\"canvasHeight\"\r\n            ref=\"canvas\"\r\n            @click=\"selectFile\"\r\n            @touchstart=\"handlePointerStart\"\r\n            @mousedown=\"handlePointerStart\"\r\n            @pointerstart=\"handlePointerStart\"\r\n            @touchend=\"handlePointerEnd\"\r\n            @touchcancel=\"handlePointerEnd\"\r\n            @mouseup=\"handlePointerEnd\"\r\n            @pointerend=\"handlePointerEnd\"\r\n            @pointercancel=\"handlePointerEnd\"\r\n            @touchmove=\"handlePointerMove\"\r\n            @mousemove=\"handlePointerMove\"\r\n            @pointermove=\"handlePointerMove\"\r\n            @DOMMouseScroll=\"handleWheel\"\r\n            @mousewheel=\"handleWheel\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import u from './util'\r\n  import debounce from 'lodash/debounce'\r\n\r\n  export default {\r\n    props: {\r\n      width: Number,\r\n      height: Number,\r\n      placeholder: String,\r\n      placeholderColor: String,\r\n      canvasColor: String,\r\n      quality: {\r\n        default: 2,\r\n        type: Number\r\n      },\r\n      zoomSpeed: {\r\n        default: 3,\r\n        type: Number,\r\n        validator: function (val) {\r\n          return val > 0\r\n        }\r\n      }\r\n    },\r\n\r\n    data () {\r\n      return {\r\n        canvas: null,\r\n        ctx: null,\r\n        img: null,\r\n        hasTarget: false,\r\n        dragging: false,\r\n        lastMovingCoord: null,\r\n        imgData: {},\r\n        dataUrl: ''\r\n      }\r\n    },\r\n\r\n    computed: {\r\n      canvasWidth () {\r\n        return this.width * this.quality\r\n      },\r\n\r\n      canvasHeight () {\r\n        return this.height * this.quality\r\n      }\r\n    },\r\n\r\n    mounted () {\r\n      this.init()\r\n    },\r\n\r\n    methods: {\r\n      init () {\r\n        this.canvas = this.$refs.canvas\r\n        this.canvas.style.backgroundColor = this.canvasColor || '#e6e6e6'\r\n        this.canvas.style.width = this.width + 'px'\r\n        this.canvas.style.height = this.height + 'px'\r\n        this.ctx = this.canvas.getContext('2d')\r\n        this.unset()\r\n        this.$emit('init', {\r\n          reset: this.unset,\r\n          selectFile: this.selectFile,\r\n          generateDataUrl: this.generateDataUrl\r\n        })\r\n      },\r\n\r\n      unset () {\r\n        let ctx = this.ctx\r\n        ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\r\n        ctx.textBaseline = 'middle'\r\n        ctx.textAlign = 'center'\r\n        ctx.font = (this.canvasWidth / 2 / this.placeholder.length) + 'px sans-serif'\r\n        ctx.fillStyle = this.placeholderColor || '#606060'\r\n        ctx.fillText(this.placeholder, this.canvasWidth / 2, this.canvasHeight / 2)\r\n        this.hasTarget = false\r\n      },\r\n\r\n      selectFile () {\r\n        if (this.hasTarget) return\r\n        // this.$refs.fileInput.value = ''\r\n        this.$refs.fileInput.click()\r\n      },\r\n\r\n      handleInputChange () {\r\n        let input = this.$refs.fileInput\r\n        if (!input.files.length) return\r\n        let file = input.files[0]\r\n        let fd = new FileReader()\r\n        fd.onload = (e) => {\r\n          let fileData = e.target.result\r\n          let img = new Image()\r\n          img.src = fileData\r\n          img.onload = () => {\r\n            this.img = img\r\n            this.imgData.startX = 0\r\n            this.imgData.startY = 0\r\n            let imgWidth = img.naturalWidth\r\n            let imgHeight = img.naturalHeight\r\n            if (imgWidth > imgHeight) {\r\n              let ratio = imgHeight / this.canvasHeight\r\n              this.imgData.width = imgWidth / ratio\r\n              this.imgData.height = this.canvasHeight\r\n            } else {\r\n              let ratio = imgWidth / this.canvasWidth\r\n              this.imgData.width = this.canvasWidth\r\n              this.imgData.height = imgHeight / ratio\r\n            }\r\n            this.draw()\r\n          }\r\n        }\r\n\r\n        fd.readAsDataURL(file)\r\n      },\r\n\r\n      handlePointerStart (evt) {\r\n        if (evt.which && evt.which > 1) return\r\n        this.dragging = true\r\n      },\r\n\r\n      handlePointerEnd (evt) {\r\n        this.dragging = false\r\n        this.lastMovingCoord = null\r\n      },\r\n\r\n      handlePointerMove (evt) {\r\n        if (!this.dragging) return\r\n        let coord = u.getPointerCoords(evt, this)\r\n        if (this.lastMovingCoord) {\r\n          this.move({\r\n            x: coord.x - this.lastMovingCoord.x,\r\n            y: coord.y - this.lastMovingCoord.y\r\n          })\r\n        }\r\n        this.lastMovingCoord = coord\r\n      },\r\n\r\n      handleWheel (evt) {\r\n        evt.preventDefault()\r\n        evt.stopPropagation()\r\n        let coord = u.getPointerCoords(evt, this)\r\n        if (evt.wheelDelta < 0 || evt.detail < 0) {\r\n          // 手指向上\r\n          this.zoom(true, coord)\r\n        } else if (evt.wheelDelta > 0 || evt.detail > 0) {\r\n          // 手指向下\r\n          this.zoom(false, coord)\r\n        }\r\n      },\r\n\r\n      move (offset) {\r\n        if (!offset) return\r\n        this.imgData.startX += offset.x\r\n        this.imgData.startY += offset.y\r\n        this.draw()\r\n      },\r\n\r\n      zoom (zoomIn, pos) {\r\n        let speed = (this.canvasWidth / 100000) * this.zoomSpeed\r\n        let x = 1\r\n        if (zoomIn) {\r\n          x = 1 + speed\r\n        } else if (this.imgData.width > 20) {\r\n          x = 1 - speed\r\n        }\r\n        this.imgData.width = this.imgData.width * x\r\n        this.imgData.height = this.imgData.height * x\r\n        let offsetX = (x - 1) * (pos.x - this.imgData.startX)\r\n        let offsetY = (x - 1) * (pos.y - this.imgData.startY)\r\n        this.imgData.startX = this.imgData.startX - offsetX\r\n        this.imgData.startY = this.imgData.startY - offsetY\r\n        this.draw()\r\n      },\r\n\r\n      draw () {\r\n        let ctx = this.ctx\r\n        if (!this.imgData || !this.imgData.width) return\r\n        let { startX, startY, width, height } = this.imgData\r\n        ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\r\n        ctx.drawImage(this.img, startX, startY, width, height)\r\n        this.hasTarget = true\r\n      },\r\n\r\n      generateDataUrl () {\r\n        if (!this.hasTarget) return ''\r\n        return this.canvas.toDataURL()\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n  .croppa-container \r\n    display: inline-block\r\n    cursor: pointer\r\n    transition: opacity .3s\r\n    &:hover\r\n      opacity: .7\r\n    &.croppa--has-target\r\n      cursor: move\r\n      // cursor: -moz-grab\r\n      &:hover\r\n        opacity: 1\r\n  .image\r\n    max-width: 100%\r\n    max-height: 100%\r\n</style>\r\n","import { version } from '../package.json'\r\nimport cropper from './cropper.vue'\r\n\r\nconst VueCroppa = {\r\n  install: function (Vue, options) {\r\n    Vue.component('croppa', cropper)\r\n  }\r\n}\r\n\r\nexport default VueCroppa"],"names":["evt","cropperVM","canvas","quality","rect","getBoundingClientRect","clientX","touches","clientY","left","top","global","freeGlobal","render","Number","String","val","width","height","init","$refs","style","backgroundColor","canvasColor","ctx","getContext","unset","$emit","selectFile","generateDataUrl","clearRect","canvasWidth","canvasHeight","textBaseline","textAlign","font","placeholder","length","fillStyle","placeholderColor","fillText","hasTarget","fileInput","click","input","files","file","fd","FileReader","onload","e","fileData","target","result","img","Image","src","imgData","startX","startY","imgWidth","naturalWidth","imgHeight","naturalHeight","ratio","draw","readAsDataURL","which","dragging","lastMovingCoord","coord","u","getPointerCoords","move","x","y","preventDefault","stopPropagation","wheelDelta","detail","zoom","offset","zoomIn","pos","speed","zoomSpeed","offsetX","offsetY","drawImage","toDataURL","VueCroppa","Vue","options","component","cropper"],"mappings":"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"}